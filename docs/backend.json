{
  "entities": {
    "Game": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Game",
      "type": "object",
      "description": "Represents a single game instance.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Game entity."
        },
        "adminId": {
          "type": "string",
          "description": "Reference to the Admin user who created the game. (Relationship: Admin 1:N Game)"
        },
        "startTime": {
          "type": "string",
          "description": "The date and time the game started.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The date and time the game ended. Can be null if the game is still in progress.",
          "format": "date-time"
        },
        "settings": {
          "type": "string",
          "description": "JSON string containing game settings, such as round duration, scoring rules, etc."
        }
      },
      "required": [
        "id",
        "adminId",
        "startTime",
        "settings"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Admin entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the admin user."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the admin user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the admin user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "googleId",
        "displayName",
        "email"
      ]
    },
    "Contestant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contestant",
      "type": "object",
      "description": "Represents a contestant participating in a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Contestant entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the contestant user."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the contestant user."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the contestant's avatar image.",
          "format": "uri"
        },
        "gameId": {
          "type": "string",
          "description": "Reference to the Game this contestant is participating in. (Relationship: Game 1:N Contestant)"
        }
      },
      "required": [
        "id",
        "googleId",
        "displayName",
        "avatarUrl",
        "gameId"
      ]
    },
    "Round": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Round",
      "type": "object",
      "description": "Represents a single round within a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Round entity."
        },
        "gameId": {
          "type": "string",
          "description": "Reference to the Game this round belongs to. (Relationship: Game 1:N Round)"
        },
        "question": {
          "type": "string",
          "description": "The question asked in this round."
        },
        "correctPersona": {
          "type": "string",
          "description": "The correct persona for this round."
        },
        "correctAction": {
          "type": "string",
          "description": "The correct action for this round."
        },
        "startTime": {
          "type": "string",
          "description": "The date and time the round started.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The date and time the round ended.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "gameId",
        "question",
        "correctPersona",
        "correctAction",
        "startTime",
        "endTime"
      ]
    },
    "Response": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Response",
      "type": "object",
      "description": "Represents a contestant's response to a round.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Response entity."
        },
        "roundId": {
          "type": "string",
          "description": "Reference to the Round this response belongs to. (Relationship: Round 1:N Response)"
        },
        "contestantId": {
          "type": "string",
          "description": "Reference to the Contestant who submitted this response. (Relationship: Contestant 1:N Response)"
        },
        "personaGuess": {
          "type": "string",
          "description": "The contestant's persona guess."
        },
        "actionGuess": {
          "type": "string",
          "description": "The contestant's action guess."
        },
        "submissionTime": {
          "type": "string",
          "description": "The date and time the response was submitted.",
          "format": "date-time"
        },
        "isCorrect": {
          "type": "boolean",
          "description": "Indicates whether the response was correct."
        },
        "score": {
          "type": "number",
          "description": "The score awarded for this response."
        }
      },
      "required": [
        "id",
        "roundId",
        "contestantId",
        "personaGuess",
        "actionGuess",
        "submissionTime",
        "isCorrect",
        "score"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores administrator user profiles. Admin users can create and manage games. Path-based ownership is used for access control.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator user."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}/games/{gameId}",
        "definition": {
          "entityName": "Game",
          "schema": {
            "$ref": "#/backend/entities/Game"
          },
          "description": "Stores game instances created by admins. Includes denormalized 'adminId' for authorization independence. Each game document contains the game settings and metadata.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator user who created the game."
            },
            {
              "name": "gameId",
              "description": "The unique identifier of the game instance."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}/games/{gameId}/contestants/{contestantId}",
        "definition": {
          "entityName": "Contestant",
          "schema": {
            "$ref": "#/backend/entities/Contestant"
          },
          "description": "Stores contestant profiles for a given game. Includes 'gameId' which is denormalized from the parent document for authorization independence.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator user who created the game."
            },
            {
              "name": "gameId",
              "description": "The unique identifier of the game instance."
            },
            {
              "name": "contestantId",
              "description": "The unique identifier of the contestant user."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}/games/{gameId}/rounds/{roundId}",
        "definition": {
          "entityName": "Round",
          "schema": {
            "$ref": "#/backend/entities/Round"
          },
          "description": "Stores rounds for a given game. Includes 'gameId' which is denormalized from the parent document for authorization independence.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator user who created the game."
            },
            {
              "name": "gameId",
              "description": "The unique identifier of the game instance."
            },
            {
              "name": "roundId",
              "description": "The unique identifier of the round within the game."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}/games/{gameId}/rounds/{roundId}/responses/{responseId}",
        "definition": {
          "entityName": "Response",
          "schema": {
            "$ref": "#/backend/entities/Response"
          },
          "description": "Stores contestant responses for a given round. Includes 'roundId' for authorization independence.  Responses are secured by round and contestant.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator user who created the game."
            },
            {
              "name": "gameId",
              "description": "The unique identifier of the game instance."
            },
            {
              "name": "roundId",
              "description": "The unique identifier of the round within the game."
            },
            {
              "name": "responseId",
              "description": "The unique identifier of the response."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Prompt Jeopardy game, focusing on authorization independence, clarity, and scalability. It leverages path-based ownership for user-related data and denormalization to avoid complex security rules that require `get()` calls. The structure supports the core features of the application, including game creation, contestant participation, round management, and response tracking, while ensuring data integrity and security.\n\nAuthorization Independence is achieved by storing authorization-related data (adminId) within the `games` and nested collections (rounds, responses). This avoids the need for security rules to fetch parent document data.  The structure enables secure `list` operations (QAPs) by segregating data based on ownership (admins owning games, contestants owning responses). Admin data (roles) are stored separately.\n\nThe inclusion of `adminId` and `gameId` within the nested collections avoids hierarchical dependencies. Game settings are stored as a JSON string within the game documents, to allow flexible schema while maintaining schema consistency.\n\nThe use of path-based ownership (`/admins/{adminId}/games/{gameId}`) ensures that only the admin who created the game has access to manage it."
  }
}